{"version":3,"sources":["../../src/models/Log.js"],"names":["ObjectId","mongoose","Schema","Types","logSchema","createdAt","type","Date","required","String","user","Log","module","exports","model","createLoginLog","userId","err","log","findOne","sort","Model","deltaMinute","create"],"mappings":";;;;AAAA;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAIA,WAAWC,mBAASC,MAAT,CAAgBC,KAAhB,CAAsBH,QAArC;AACA,IAAII,YAAYH,mBAASC,MAAT,CAAgB;AAC9BG,aAAW;AACTC,UAAMC,IADG;AAETC,cAAU;AAFD,GADmB;AAK9BF,QAAM;AACJA,UAAMG,MADF;AAEJD,cAAU;AAFN,GALwB;AAS9BE,QAAM;AACJJ,UAAMN,QADF;AAEJQ,cAAU;AAFN;AATwB,CAAhB,CAAhB;;AAeA,IAAIG,MAAMC,OAAOC,OAAP,GAAiBZ,mBAASa,KAAT,CAAe,KAAf,EAAsBV,SAAtB,CAA3B;;AAEAQ,OAAOC,OAAP,CAAeE,cAAf;AAAA,qEAAgC,iBAAOC,MAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAC1BC,eAD0B,WACrBC,GADqB;AAAA;AAAA,mBAEX,kBAAGP,IAAIQ,OAAJ,CAAY,EAAET,MAAMM,MAAR,EAAiBV,MAAM,OAAvB,EAAZ,EAA8C,IAA9C,EAAoD,EAACc,MAAM,EAACf,WAAW,CAAC,CAAb,EAAP,EAApD,CAAH,CAFW;;AAAA;AAAA;AAAA;AAE7BY,eAF6B;AAExBC,eAFwB;;AAAA,iBAG3BD,GAH2B;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA,iBAI3BC,GAJ2B;AAAA;AAAA;AAAA;;AAAA,kBAKzBG,gBAAMC,WAAN,CAAkB,IAAIf,IAAJ,EAAlB,EAA8BW,IAAIb,SAAlC,IAA+C,EALtB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAO9BM,gBAAIY,MAAJ,CAAW,EAACjB,MAAM,OAAP,EAAgBI,MAAMM,MAAtB,EAA8BX,WAAW,IAAIE,IAAJ,EAAzC,EAAX;;AAP8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAhC;;AAAA;AAAA;AAAA;AAAA","file":"Log.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport to from'../to';\r\nimport Model from './Model';\r\n\r\nvar ObjectId = mongoose.Schema.Types.ObjectId;\r\nvar logSchema = mongoose.Schema({\r\n  createdAt: {\r\n    type: Date,\r\n    required: true\r\n  },\r\n  type: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  user: {\r\n    type: ObjectId,\r\n    required: true\r\n  }\r\n})\r\n\r\nvar Log = module.exports = mongoose.model('log', logSchema);\r\n\r\nmodule.exports.createLoginLog = async (userId)=>{\r\n  let err, log;\r\n  [err, log] = await to(Log.findOne({ user: userId , type: 'login' }, null, {sort: {createdAt: -1 }}));\r\n  if(err){ return; }\r\n  if(log){\r\n    if(Model.deltaMinute(new Date(), log.createdAt) < 60){ return; }\r\n  }\r\n  Log.create({type: 'login', user: userId, createdAt: new Date()});\r\n}\r\n"]}